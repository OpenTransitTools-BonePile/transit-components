{"version":3,"sources":["VehicleMarker.js"],"names":["VehicleMarker","v","props","vehicle","position","lat","lon","status","stopSequence","lastReport","seconds","min","Math","floor","sec","minStr","vehicleId","indexOf","replace","stopLink","stopId","icon","routeType","routeShortName","heading","rsn","length","key","id","routeLongName","reportDate","tripId","blockId","L","Browser","mobile","React","Component"],"mappings":"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","sourcesContent":["import React from 'react';\n\nimport 'leaflet';\nimport 'leaflet-rotatedmarker';\nimport { Marker, Popup, Tooltip } from \"react-leaflet\";\nimport RotatedMarker from '../map/RotatedMarker';\nimport makeVehicleIcon from './icons';\n\nclass VehicleMarker extends React.Component {\n  render() {\n    const v = this.props.vehicle;\n    const position = [v.lat, v.lon];\n\n    let status = \"unknown\";\n    if(v.status == \"IN_TRANSIT_TO\")\n      status = \"en-route to stop \";\n    else if(v.status == \"STOPPED_AT\")\n      if(v.stopSequence == 1)\n        status = \"beginning route from stop \";\n      else\n        status = \"stopped at \";\n\n    let lastReport = \"\";\n    if(v.seconds > 60) {\n      const min = Math.floor(v.seconds / 60);\n      const sec = v.seconds - min * 60;\n      const minStr = min == 1 ? \"minute\" : \"minutes\";\n\n      if(sec > 0)\n        lastReport = `${min} ${minStr} & ${sec} seconds ago`;\n      else\n        lastReport = `${min} ${minStr} ago`;\n    } else {\n      lastReport = `${v.seconds} seconds ago`;\n    }\n\n    let vehicle = \"\";\n    if(v.vehicleId.indexOf('+') > 0)\n      vehicle = \"Vehicles: \" + v.vehicleId.replace(/\\+/g, \", \");\n    else\n      vehicle = \"Vehicle: \" + v.vehicleId;\n\n    const stopLink = `https://trimet.org/ride/stop.html?stop_id=${v.stopId}`;\n    const icon = makeVehicleIcon(v.routeType, v.routeShortName);\n\n    let heading = v.heading;\n    if(heading == null || heading < 0 || heading >= 360)\n      heading = 1;\n\n    let rsn = v.routeShortName;\n    if(rsn != null && rsn.length <= 3)\n      rsn = \"Line \" + rsn;\n\n    return(\n      <RotatedMarker key={\"rm_\" + this.props.key} rotationAngle={heading} rotationOrigin={'center center'} icon={icon} key={v.id} position={position} >\n        <Popup key={\"pop_\" + this.props.key} >\n          <div>\n            <span><b>{v.routeLongName}</b></span><br/>\n            <span>Last reported: {lastReport}</span><br/>\n            <span>Report date: {v.reportDate}</span><br/>\n            <span>Status: {status} <a target=\"#\" href={stopLink}>{v.stopId}</a></span><br/>\n            <span>Trip: {v.tripId}, Block: {v.blockId}</span><br/>\n            <span>{vehicle}</span><br/>\n          </div>\n        </Popup>\n        { (L.Browser.mobile !== true) &&\n          <Tooltip key={\"tt_\" + this.props.key} >\n            <span><b>{rsn}</b>: {lastReport}</span>\n          </Tooltip>\n        }\n      </RotatedMarker>\n    );\n  }\n}\n\nexport default VehicleMarker;"]}